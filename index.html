<!doctype html>
<html lang="en">

<head>
	<title>Leaflet Provider Demo</title>
	<meta charset="utf-8" />
	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
	<!-- Leaflet style. REQUIRED! -->
	<link rel="stylesheet" href="https://unpkg.com/leaflet@1.0.3/dist/leaflet.css" />
	<link rel="manifest" id="manifest">
	<style>
		html {
			height: 100%
		}

		body {
			height: 100%;
			margin: 0;
			padding: 0;
		}

		.map {
			height: 100%
		}

		.leaflet-control-layers-expanded {
			max-height: calc(100vh - 10px - 50px);
		}
	</style>
</head>

<body>
	<div id="map" class="map"></div>

	<script src="https://unpkg.com/leaflet@1.0.3/dist/leaflet.js"></script>
	<script src="leaflet-providers.js"></script>
	<script>
		var map = L.map('map', {
			center: [48, -3],
			zoom: 5,
			zoomControl: false
		});

		var defaultLayer = L.tileLayer.provider('OpenStreetMap.Mapnik');

		var baseLayers = {
			'OpenStreetMap Default': defaultLayer,
			'OpenStreetMap German Style': L.tileLayer.provider('OpenStreetMap.DE'),
			'OpenStreetMap H.O.T.': L.tileLayer.provider('OpenStreetMap.HOT'),
			'Thunderforest OpenCycleMap': L.tileLayer.provider('Thunderforest.OpenCycleMap'),
			'Thunderforest Transport': L.tileLayer.provider('Thunderforest.Transport'),
			'Thunderforest Landscape': L.tileLayer.provider('Thunderforest.Landscape'),
			'Hydda Full': L.tileLayer.provider('Hydda.Full'),
			'Stamen Toner': L.tileLayer.provider('Stamen.Toner'),
			'Stamen Terrain': L.tileLayer.provider('Stamen.Terrain'),
			'Stamen Watercolor': L.tileLayer.provider('Stamen.Watercolor'),
			'Jawg Streets': L.tileLayer.provider('Jawg.Streets'),
			'Jawg Terrain': L.tileLayer.provider('Jawg.Terrain'),
			'Esri WorldStreetMap': L.tileLayer.provider('Esri.WorldStreetMap'),
			'Esri DeLorme': L.tileLayer.provider('Esri.DeLorme'),
			'Esri WorldTopoMap': L.tileLayer.provider('Esri.WorldTopoMap'),
			'Esri WorldImagery': L.tileLayer.provider('Esri.WorldImagery'),
			'Esri WorldTerrain': L.tileLayer.provider('Esri.WorldTerrain'),
			'Esri WorldShadedRelief': L.tileLayer.provider('Esri.WorldShadedRelief'),
			'Esri WorldPhysical': L.tileLayer.provider('Esri.WorldPhysical'),
			'Esri OceanBasemap': L.tileLayer.provider('Esri.OceanBasemap'),
			'Esri NatGeoWorldMap': L.tileLayer.provider('Esri.NatGeoWorldMap'),
			'Esri WorldGrayCanvas': L.tileLayer.provider('Esri.WorldGrayCanvas'),
			'Geoportail France Maps': L.tileLayer.provider('GeoportailFrance'),
			'Geoportail France Orthos': L.tileLayer.provider('GeoportailFrance.orthos'),
			'Geoportail France classic maps': L.tileLayer.provider('GeoportailFrance.ignMaps')
		};

		var overlayLayers = {
			'OpenSeaMap': L.tileLayer.provider('OpenSeaMap'),
			'OpenWeatherMap Clouds': L.tileLayer.provider('OpenWeatherMap.Clouds'),
			'OpenWeatherMap CloudsClassic': L.tileLayer.provider('OpenWeatherMap.CloudsClassic'),
			'OpenWeatherMap Precipitation': L.tileLayer.provider('OpenWeatherMap.Precipitation'),
			'OpenWeatherMap PrecipitationClassic': L.tileLayer.provider('OpenWeatherMap.PrecipitationClassic'),
			'OpenWeatherMap Rain': L.tileLayer.provider('OpenWeatherMap.Rain'),
			'OpenWeatherMap RainClassic': L.tileLayer.provider('OpenWeatherMap.RainClassic'),
			'OpenWeatherMap Pressure': L.tileLayer.provider('OpenWeatherMap.Pressure'),
			'OpenWeatherMap PressureContour': L.tileLayer.provider('OpenWeatherMap.PressureContour'),
			'OpenWeatherMap Wind': L.tileLayer.provider('OpenWeatherMap.Wind'),
			'OpenWeatherMap Temperature': L.tileLayer.provider('OpenWeatherMap.Temperature'),
			'OpenWeatherMap Snow': L.tileLayer.provider('OpenWeatherMap.Snow'),
			'Geoportail France Parcels': L.tileLayer.provider('GeoportailFrance.parcels')
		};

		if (location.hash.length > 1) {
			var rawHash = decodeURIComponent(location.hash.replace(/^#/, ''));
			if (baseLayers.hasOwnProperty(rawHash)) baseLayers[rawHash].addTo(map);
			else if (/^https?:\/\//.test(rawHash)) {
				L.TileLayer.Provider.providers.Custom = {
					url: rawHash,
					options: {
						attribution: 'Please respect the map providerâ€™s copyright'
					},
				};
				baseLayers.Custom = L.tileLayer.provider('Custom');
				baseLayers.Custom.addTo(map);
			}
			else defaultLayer.addTo(map);
		} else {
			defaultLayer.addTo(map);
		}

		if (location.search.length > 1) {
			var rawSearch = location.search.replace(/^\?/, '');
			const [zoom, lat, lng] = rawSearch.split('/');
			map.setView({ lat, lng }, zoom);
		}

		L.control.layers(baseLayers, overlayLayers, { collapsed: true }).addTo(map);

		map.on('zoomend moveend', function () {
			var { lat, lng } = map.getCenter();
			var zoom = map.getZoom();
			var posString = [zoom, lat, lng].join("/");
			history.replaceState(null, '', location.pathname + "?" + posString + location.hash);
		});

		window.addEventListener("hashchange", () => location.reload());

		var myDynamicManifest = {
			"name": "Leaflet Preview",
			"short_name": "Leaflet",
			"description": "Leaflet Preview for " + location.hash,
			"start_url": "/" + location.hash,
			"background_color": "#fff",
			"theme_color": "#00f",
			// "icons": [{
			// 	"src": "whatever.png",
			// 	"sizes": "256x256",
			// 	"type": "image/png"
			// }]
		}
		const stringManifest = JSON.stringify(myDynamicManifest);
		const blob = new Blob([stringManifest], { type: 'application/json' });
		const manifestURL = URL.createObjectURL(blob);
		document.querySelector('#my-manifest-placeholder').setAttribute('href', manifestURL);
	</script>
</body>

</html>